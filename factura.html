<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title></title>
  
  <style>
    /* ‚ö†Ô∏è Estilos Cr√≠ticos para POS 58mm (VISUALIZACI√ìN Y IMPRESI√ìN) */
    body {
      /* Permitir que el body ocupe el ancho completo para centrar el ticket */
      width: 100%; 
      font-family: monospace, sans-serif; /* Fuente simple para mejor impresi√≥n t√©rmica */
      font-size: 10px; /* TAMA√ëO DE FUENTE BASE AUMENTADO (10px) */
      margin: 0;
      padding: 0;
      color: #000;
      /* Fondo gris claro para que el ticket blanco resalte en el centro */
      background: #f0f0f0; 
    }

    .page {
      /* Ancho y m√°rgenes para simular el ticket y CENTRARLO */
      width: 58mm;
      max-width: 58mm;
      background: #fff; /* Fondo blanco del ticket */
      margin: 20px auto; /* ESTO CENTRA EL TICKET EN PANTALLA */
      padding: 5px 3px; /* M√≠nimo padding horizontal */
      box-sizing: border-box;
      box-shadow: 0 0 5px rgba(0,0,0,0.2); /* Ligera sombra para separar del fondo web */
    }

    /* ==== ENCABEZADO Y T√çTULOS ==== */
    .header-column {
      text-align: center;
      margin-bottom: 5px; 
    }

    /* NUEVO: ESTILOS PARA EL LOGO */
    .header-column .logo {
      height: auto; /* Permitir que ocupe espacio */
      width: 100%; /* Ocupar el ancho disponible para centrar */
      margin-bottom: 5px; /* Peque√±o margen debajo del logo */
      overflow: visible;
    }
    
    .header-column .logo img {
        width: 40px; /* Tama√±o del logo (ajustar seg√∫n necesidad) */
        height: auto; /* Mantener proporci√≥n */
        filter: grayscale(100%); /* CONVERTIR A BLANCO Y NEGRO */
        display: block; /* Para que margin: auto funcione */
        margin: 0 auto; /* Centrar el logo */
    }

    .store-info h2 {
      margin: 0;
      font-size: 14px; /* T√≠tulo de la tienda GRANDE */
      font-weight: 900; 
    }

    .store-info p {
      margin: 0; 
      font-size: 9px; /* Direcci√≥n y Tel√©fono */
      line-height: 1.1; 
    }

    .factura-info {
      margin-top: 5px;
      padding: 0;
      text-align: center;
    }
    
    .factura-info span {
        font-size: 10px;
    }
    
    #factura-num {
      font-size: 16px !important; /* N√öMERO DE FACTURA ENORME */
      font-weight: 900;
      margin-top: 2px;
    }

    /* ==== META (Cliente/Fecha) ==== */
    .meta {
      font-size: 11px; 
      line-height: 1.3; 
      margin-bottom: 8px; 
      padding-top: 5px;
      font-weight: 700; 
    }
    
    .meta div {
        margin: 0;
        padding: 0;
    }


    /* ==== L√çNEA DIVISORA (CR√çTICA) ==== */
    hr {
      border: none;
      border-top: 1px dashed #000; /* L√≠nea de puntos clara */
      margin: 6px 0; 
    }

    /* ==== TABLA (Productos) - Maximizando fuentes sin desbordar 4 columnas ==== */
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 10px;
      table-layout: fixed;
    }

    th {
      text-align: left;
      padding: 3px 0; 
      font-weight: 900;
      border-bottom: 2px solid #000; /* L√≠nea separadora gruesa */
    }
    
    /* Anchos de columna balanceados para que el producto quepa lo mejor posible */
    #items-table thead tr th:first-child { width: 45%; text-align: left; } /* Producto */
    #items-table thead tr th.qty { width: 10%; text-align: center; } /* Cantidad */
    #items-table thead tr th.price { width: 20%; text-align: right; } /* Precio Unitario */
    #items-table thead tr th.total { width: 25%; text-align: right; } /* Total */

    td {
      padding: 3px 0; 
      line-height: 1.3; 
    }

    td strong {
        font-size: 11px; /* NOMBRE DEL PRODUCTO M√ÅS GRANDE */
        font-weight: 900;
    }
    
    td small {
        display: block; 
        font-size: 8px; /* Instrucciones peque√±as para ahorrar espacio vertical */
        color: #000 !important; /* Fuerza el color negro para m√°xima legibilidad */
        margin-top: 1px;
    }

    /* Alineaciones y visibilidad de n√∫meros */
    td.qty { 
        text-align: center; 
        font-size: 11px;
        font-weight: 900;
    }
    td.price { 
        text-align: right;
        font-size: 10px;
    }
    td.total { 
        text-align: right; 
        font-size: 11px;
        font-weight: 900;
    }


    /* ==== TOTALES ==== */
    .totals {
      margin-top: 5px;
      padding: 0;
    }

    .totals .row {
      display: flex;
      justify-content: space-between;
      font-size: 11px; /* Letra grande para sub-totales */
      line-height: 1.4;
    }
    
    .totals .row div:last-child {
        font-weight: 900; 
    }

    .totals .row.total {
      font-weight: 900;
      border-top: 1px dashed #000;
      margin-top: 6px;
      padding-top: 6px;
      font-size: 16px; /* Tama√±o por defecto ENORME para las filas .total */
    }
    
    /* REGLA SOLICITADA: Total sin propina m√°s peque√±o (9px) */
    .totals .row.total:not(#total-final-row) {
        font-size: 12px; 
        font-weight: 900;
    }

    /* ESTILO: TOTAL A PAGAR (Grande, 16px) - El ID tiene m√°s prioridad que el selector anterior */
    .totals .row#total-final-row { 
        font-size: 16px;
        font-weight: 900;
    }
    
    /* M√©todo de pago se destaca con fuente grande */
    #metodo-pago-row {
        align-items: center;
        font-size: 12px; 
        line-height: 1.5;
        font-weight: 900;
    }

    /* ==== OBSERVACIONES Y FOOTER ==== */
    .observaciones {
      display: flex;
      justify-content: center;
      margin-top: 20px;
      margin-bottom: 20px;
      font-size: 10px;
      font-weight: 700;
    }

    /* Estilos para el contenedor del QR (Centrado en ticket) */
.qr-container { /* CAMBIO AQU√ç: Usamos la clase expl√≠cita */
  text-align: center; /* Centra el contenido (texto y QR como inline) */
  margin-top: 10px;
  padding-top: 5px;
  border-top: 1px dashed #000;
}

/* Y sus descendientes: */
.qr-container p:first-child { /* CAMBIO AQU√ç */
    font-size: 10px;
    font-weight: 700;
}

.qr-container img { /* CAMBIO AQU√ç */
    /* Tama√±o del QR se mantiene peque√±o (80px) para no desbordar */
    width: 80px !important; 
    height: 80px !important;
    /* FIX: Asegurar que la imagen se centre correctamente */
    display: block; /* Tratar la imagen como un bloque */
    margin: 3px auto; /* Centrar con m√°rgenes autom√°ticos */
}

.qr-container p:last-child { /* CAMBIO AQU√ç */
    margin-top: 10px;
    padding: 0;
    line-height: 1.1;
    font-size: 8px;
    word-break: break-all;
}

    .footer {
      text-align: center;
      margin-top: 12px;
      font-size: 9px; 
      line-height: 1.2;
    }

    /* ESTILOS PARA QUE LOS BOTONES SE VEAN EN EL NAVEGADOR */
    .print-actions {
      text-align: center;
      margin-top: 15px;
      padding-top: 10px;
      border-top: 1px dashed #ccc; /* Separador visual en web */
      display: block !important; 
    }
    
    .print-actions button {
        padding: 5px 10px;
        margin: 5px;
        font-size: 10px; /* Reducido para que quepa bien en el 58mm simulado */
        cursor: pointer;
        border: 1px solid #000;
        border-radius: 4px;
        font-weight: 700;
    }
    
    .print-actions #btn-print {
        background: #e6ffec;
        color: #007c1f;
        border-color: #007c1f;
    }
    
    .print-actions #btn-close {
        background: #ffe6e6;
        color: #cc0000;
        border-color: #cc0000;
    }

    /* Estilos para el contenedor del QR (Centrado en ticket) */
    .footer + div {
      text-align: center; /* Centra el contenido (texto y QR como inline) */
      margin-top: 10px;
      padding-top: 5px;
      border-top: 1px dashed #000;
    }
    
    .footer + div p:first-child {
        font-size: 10px;
        font-weight: 700;
    }
    
    .footer + div img {
        /* Tama√±o del QR se mantiene peque√±o (80px) para no desbordar */
        width: 80px !important; 
        height: 80px !important;
        /* FIX: Asegurar que la imagen se centre correctamente */
        display: block; /* Tratar la imagen como un bloque */
        margin: 3px auto; /* Centrar con m√°rgenes autom√°ticos */
    }
    
    .footer + div p:last-child {
        margin: 0;
        padding: 0;
        line-height: 1.1;
        font-size: 8px;
        word-break: break-all;
    }
    

    /* Media Query de impresi√≥n final (Asegura la impresi√≥n 58mm sin fondo gris) */
    @media print {
      body {
        background: #fff !important; /* Sin fondo en impresi√≥n */
        width: 58mm;
        max-width: 58mm;
      }
      
      .page {
        margin: 0; /* Ocupa todo el espacio de impresi√≥n */
        box-shadow: none;
        padding: 5px 3px; 
      }
      
      /* REGLA CR√çTICA: Oculta los botones solo al imprimir */
      .print-actions {
        display: none !important;
      }
      
      * {
        color: #000 !important;
        background: #fff !important;
      }
    }
  </style>


</head>

<body>
  <div class="page" id="page">
    <header class="header-column">
      <div class="store-info">
        <h2 id="store-name"></h2>
        <p id="store-address"></p>
        <p id="store-phone"></p>
      </div>

      <div class="factura-info">
        <span>FACTURA N¬∞</span>
        <div id="factura-num"></div>
      </div>
    </header>

    <hr />

    <div class="meta">
      <div class="left">
        <span id="cliente-nombre">Cliente: ---</span><br>
        <span id="cliente-phone">Tel: ---</span><br>
        <span id="cliente-direccion">Direcci√≥n: ---</span><br>
        <div id="fecha">Fecha: --</div>
        <div id="hora">Hora: --</div>
        <div id="tipo-entrega">Tipo: --</div>
      </div>
    </div>

    <hr />

    <table id="items-table">
      <thead>
        <tr>
          <th>PRODUCTO</th>
          <th class="qty">CANT</th>
          <th class="price">PRECIO</th>
          <th class="total">TOTAL</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <hr />

    <div class="totals">
      <div class="row">
        <div>Subtotal</div>
        <div id="subtotal">$0</div>
      </div>
      <div class="row">
        <div>Domicilio</div>
        <div id="costo-domicilio">$0</div>
      </div>
      <div class="row total">
        <div>Total sin propina</div>
        <div id="total-sin-propina"><strong>$0</strong></div>
      </div>
      <div class="row">
        <div>Propina (10%)</div>
        <div id="propina">$0</div>
      </div>
      <div class="row total" id="total-final-row">
        <div>TOTAL A PAGAR</div>
        <div id="total-pagar">$0</div>
      </div>
    </div>

    <hr />
    
    <div class="totals">
        <div class="row" id="metodo-pago-row">
            <div><strong>M√âTODO DE PAGO</strong></div>
            <div><strong>‚Äî</strong></div>
        </div>
    </div>
    
    <hr />


    <div class="observaciones">
      <strong>OBSERVACIONES:</strong>
      <div id="obs-text">‚Äî</div>
    </div>

    <div class="footer">
      <div>!GRACIAS POR SU COMPRA!</div>
      <div>Documento no fiscal, Solo para uso interno.</div>
    </div>

    <div class="print-actions">
      <button id="btn-print">üñ®Ô∏è Imprimir</button>
      <button id="btn-close">‚úñ Cerrar</button>
    </div>
  </div>

  <script>

// üè™ Cargar datos del restaurante desde config.json
fetch("config.json")
  .then(res => res.json())
  .then(data => {
    const sede = data.sede || {};
    document.getElementById("store-name").textContent = sede.nombre || "‚Äî";
    document.getElementById("store-address").textContent = sede.direccion || "‚Äî";
    document.getElementById("store-phone").textContent = "Tel: " + (sede.telefono || "‚Äî");

    // Establecer la URL del logo desde config.json si existe
    if (sede.logoUrl) {
        document.getElementById("store-logo").src = sede.logoUrl;
    } else {
        // Ocultar el logo si no hay URL para evitar un icono de imagen rota
        document.getElementById("store-logo");
    }
  })
  .catch(err => console.warn("No se pudo cargar config.json:", err));

    (function () {
      const raw = localStorage.getItem('lastPedido');
      if (!raw) {
        document.getElementById('page').innerHTML =
          '<p style="padding:18px;text-align:center;color:#c00">No se encontr√≥ informaci√≥n del pedido.</p>';
        return;
      }

      let pedido;
      try { pedido = JSON.parse(raw); } catch (e) { return; }

      const formato = n => '$' + Number(n || 0).toLocaleString('es-CO');

      document.getElementById('factura-num').textContent = (pedido.factura || '‚Äî').toUpperCase();
      document.getElementById('cliente-nombre').textContent = `Cliente: ${pedido.cliente?.nombre || ''}`;
      document.getElementById('cliente-phone').textContent = `Tel: ${pedido.cliente?.telefono || ''}`;
      document.getElementById('cliente-direccion').textContent = `Direcci√≥n: ${pedido.direccion || ''}`;
      document.getElementById('fecha').textContent = `Fecha: ${pedido.fecha || ''}`;
      document.getElementById('hora').textContent = `Hora: ${pedido.hora || ''}`;
      document.getElementById('tipo-entrega').textContent = `Tipo: ${pedido.tipoEntrega || ''}`;

      // üçΩÔ∏è Mostrar n√∫mero de mesa si el pedido es en mesa
      if (pedido.tipoEntrega === "Mesa" && pedido.cliente?.mesa) {
        const mesaEl = document.createElement("div");
        mesaEl.id = "mesa-num";
        mesaEl.textContent = `Mesa: ${pedido.cliente.mesa}`;
        document.querySelector(".meta .left").appendChild(mesaEl);
      }


      const tbody = document.querySelector('#items-table tbody');
      tbody.innerHTML = '';
      (pedido.productos || []).forEach(p => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>
            <strong>${p.nombre}</strong><br>
            ${p.instrucciones ? `<small style="color:#666">${p.instrucciones}</small>` : ''}
          </td>
          <td class="qty">${p.cantidad || 1}</td>
          <td class="price">${formato(p.precio)}</td>
          <td class="total">${formato((p.precio || 0) * (p.cantidad || 1))}</td>`;
        tbody.appendChild(tr);
      });

      // üßæ Calcular totales
      const subtotal = Number(pedido.subtotal || 0);
      const costoDomicilio = Number(pedido.costoDomicilio || 0);
      const propina = Number(pedido.propina || 0);
      const totalSinPropina = subtotal + costoDomicilio;
      const totalConPropina = totalSinPropina + propina;

      // Mostrar totales
      document.getElementById('subtotal').textContent = formato(subtotal);
      document.getElementById('costo-domicilio').textContent = formato(costoDomicilio);
      document.getElementById('total-sin-propina').textContent = formato(totalSinPropina);
      document.getElementById('propina').textContent = formato(propina);
      document.getElementById('total-pagar').textContent = formato(totalConPropina);
      document.getElementById('obs-text').textContent = pedido.observaciones || '';
      
      // üí∞ Mostrar m√©todo de pago
      document.querySelector('#metodo-pago-row div:last-child').innerHTML = `<strong>${pedido.metodoPago || 'No especificado'}</strong>`;


      // Si propina = 0, ocultar l√≠nea
      if (!propina) {
        document.getElementById('propina').parentElement.style.display = 'none';
      }

      document.getElementById('btn-print').addEventListener('click', () => window.print());
      document.getElementById('btn-close').addEventListener('click', () => {
        localStorage.removeItem('lastPedido'); 
        window.location.href = 'index.html';   
      });

// üß≠ Generaci√≥n de QR 
if (pedido.tipoEntrega === "Domicilio" && pedido.ubicacion) {
  const qrContainer = document.createElement("div");
  // A√ëADIDO: Asignar una clase para facilitar el manejo con CSS
  qrContainer.className = "qr-container"; 

  const qrTitle = document.createElement("p");
  qrTitle.textContent = "ESCANEA PARA UBICACI√ìN (DOMICILIO)";

  const qrImage = document.createElement("img");
  qrImage.alt = "C√≥digo QR ubicaci√≥n exacta";
  
  const linkCompleto = pedido.ubicacion.trim();
  const linkCodificado = encodeURIComponent(linkCompleto);
  // Usamos 100x100 para mejor escaneo, el CSS lo reducir√° a 80x80
  qrImage.src = `https://api.qrserver.com/v1/create-qr-code/?data=${linkCodificado}&size=100x100&margin=0&qzone=1`;

  qrContainer.appendChild(qrTitle);
  qrContainer.appendChild(qrImage);

  // Imprimimos el link debajo por respaldo (peque√±o)
  const linkTexto = document.createElement("p");
  linkTexto.textContent = linkCompleto;
  qrContainer.appendChild(linkTexto);
  
  document.querySelector(".footer").before(qrContainer);
}

      // autoimprimir tras abrir
      setTimeout(() => window.print(), 800);
    })();
  </script>
    <script src="config-loader.js"></script>
</body>

</html>